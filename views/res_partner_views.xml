<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue de recherche commune pour tous les contacts IT -->
    <record id="view_it_partner_filter" model="ir.ui.view">
        <field name="name">it__park.partner.search</field>
        <field name="model">res.partner</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <search string="Rechercher des contacts IT">
                <field name="name"/>
                <field name="parent_id"/>
                <field name="email"/>
                <field name="phone"/>
                
                <filter string="Clients IT" name="it_clients" domain="[('is_it_client', '=', True)]"/>
                <filter string="Sites clients" name="it_sites" domain="[('is_it_site', '=', True)]"/>
                <filter string="Fournisseurs IT" name="it_suppliers" domain="[('is_it_supplier', '=', True)]"/>
                
                <filter string="Contacts IT" name="filter_it" domain="['|', '|', '|', ('is_it_client', '=', True), ('is_it_site', '=', True), ('is_it_supplier', '=', True), '&amp;', ('parent_id.is_it_client', '=', True), ('is_company', '=', False)]"/>
                <filter string="Sociétés" name="type_company" domain="[('is_company', '=', True)]"/>
                <filter string="Personnes" name="type_person" domain="[('is_company', '=', False)]"/>
                
                <group expand="0" string="Regrouper par">
                    <filter name="group_by_company" string="Société" domain="[]" context="{'group_by': 'parent_id'}"/>
                    <filter name="group_by_country" string="Pays" domain="[]" context="{'group_by': 'country_id'}"/>
                    <filter name="group_by_state" string="Département/État" domain="[]" context="{'group_by': 'state_id'}"/>
                    <filter name="group_by_city" string="Ville" domain="[]" context="{'group_by': 'city'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Extension de la vue formulaire du partenaire -->
    <record id="view_partner_form_it_park" model="ir.ui.view">
        <field name="name">res.partner.form.it_park</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Parc IT" name="it_park" invisible="not is_company">
                    <group>
                        <field name="is_it_client" />
                        <field name="is_it_client_pending" readonly="1" invisible="not is_it_client_pending"/>
                        <field name="email_validated" readonly="1" invisible="not is_it_client and not is_it_client_pending"/>
                    </group>
                    
                    <!-- Groupe pour la validation d'email -->
                    <group string="Validation Email" invisible="not is_it_client_pending or not email">
                        <field name="email_validation_token" readonly="1" invisible="not email_validation_token"/>
                        <field name="email_validation_expiration" readonly="1" invisible="not email_validation_expiration"/>
                        <field name="email_validation_url" widget="url" readonly="1" invisible="not email_validation_url"/>
                        <button name="action_resend_validation_email" 
                                type="object" 
                                string="Renvoyer l'email de validation" 
                                class="btn-primary" 
                                invisible="not email or email_validated"/>
                        <button name="action_force_validate_email" 
                                type="object" 
                                string="Forcer la validation de l'email" 
                                class="btn-warning"
                                confirm="Cette action va valider l'email sans envoyer de lien de validation. Continuer ?"/>
                    </group>
                    
                    <group string="Équipements" invisible="not is_it_client">
                        <field name="equipment_count" />
                        <button name="action_view_equipment" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-laptop" 
                                string="Voir les équipements"
                                invisible="equipment_count == 0"/>
                    </group>
                    <group string="Licences" invisible="not is_it_client">
                        <field name="license_count" />
                        <button name="action_view_licenses" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-key" 
                                string="Voir les licences"
                                invisible="license_count == 0"/>
                    </group>
                    <group string="Incidents" invisible="not is_it_client">
                        <field name="incident_count" />
                        <button name="action_view_incidents" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-bug" 
                                string="Voir les incidents"
                                invisible="incident_count == 0"/>
                    </group>
                    <group string="Factures" invisible="not is_it_client">
                        <field name="it_invoice_count" />
                        <button name="action_view_it_invoices" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-file-text-o" 
                                string="Voir les factures"
                                invisible="it_invoice_count == 0"/>
                    </group>
                </page>
            </notebook>
        </field>
    </record>
    
    <!-- Vue liste spécifique pour les clients IT -->
    <record id="view_it_client_tree" model="ir.ui.view">
        <field name="name">it.client.tree</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="ref" string="Code client"/>
                <field name="phone"/>
                <field name="email"/>
                <field name="city"/>
                <field name="it_site_count" string="Sites"/>
                <field name="equipment_count" string="Équipements"/>
                <field name="incident_count" string="Incidents"/>
            </list>
        </field>
    </record>

    <!-- Vue kanban pour les clients IT -->
    <record id="view_it_clients_kanban" model="ir.ui.view">
        <field name="name">it.clients.kanban</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <kanban quick_create="false">
                <field name="id"/>
                <field name="name"/>
                <field name="avatar_128"/>
                <field name="is_company"/>
                <field name="parent_id"/>
                <field name="is_it_client"/>
                <field name="is_it_client_approved"/>
                <field name="is_it_contract_paid"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="website"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_res_partner_kanban">
                            <div class="o_kanban_image">
                                <field name="avatar_128" widget="image" class="o_kanban_image" />
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="name"/>
                                </strong>
                                <ul>
                                    <li t-if="record.email.raw_value"><field name="email"/></li>
                                    <li t-if="record.phone.raw_value"><field name="phone"/></li>
                                    <li t-if="record.website.raw_value">
                                        <a t-att-href="'https://' + record.website.raw_value"><field name="website"/></a>
                                    </li>
                                </ul>
                                <div t-if="record.is_it_client.raw_value">
                                    <span t-if="record.is_it_client_approved.raw_value" class="badge text-bg-success">Client approuvé</span>
                                    <span t-if="!record.is_it_client_approved.raw_value" class="badge text-bg-warning">En attente d'approbation</span>
                                    <span t-if="record.is_it_contract_paid.raw_value" class="badge text-bg-primary">Contrat actif</span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Vue formulaire spécifique pour les clients IT -->
    <record id="view_it_client_form" model="ir.ui.view">
        <field name="name">it.client.form</field>
        <field name="model">res.partner</field>
        <field name="mode">primary</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="%(portal.portal_share_action)d"
                            string="Inviter au portail" 
                            type="action"
                            class="btn btn-primary" 
                            invisible="not email or user_ids"
                            help="Inviter ce client à accéder au portail"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_sites" 
                                type="object"
                                class="oe_stat_button"
                                icon="fa-map-marker">
                            <field name="it_site_count" string="Sites" widget="statinfo"/>
                        </button>
                        <button name="action_view_equipment" 
                                type="object"
                                class="oe_stat_button"
                                icon="fa-laptop">
                            <field name="equipment_count" string="Équipements" widget="statinfo"/>
                        </button>
                        <button name="action_view_incidents" 
                                type="object"
                                class="oe_stat_button"
                                icon="fa-exclamation-triangle">
                            <field name="incident_count" string="Incidents" widget="statinfo"/>
                        </button>
                        <button name="action_view_tickets" 
                                type="object"
                                class="oe_stat_button"
                                icon="fa-life-ring">
                            <field name="ticket_count" string="Tickets" widget="statinfo"/>
                        </button>
                    </div>
                    <field name="avatar_128" widget="image" class="oe_avatar" options="{'preview_image': 'avatar_128'}"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nom du client" required="1"/>
                        </h1>
                        <h2>
                            <field name="ref" placeholder="Code client"/>
                        </h2>
                        <div name="options_box">
                            <div>
                                <field name="company_type" options="{'horizontal': true}" widget="radio"/>
                            </div>
                            <div>
                                <field name="is_company" invisible="1"/>
                                <field name="is_it_client" invisible="1"/>
                                <field name="user_ids" invisible="1"/>
                            </div>
                        </div>
                    </div>
                    <group>
                        <group name="group_left">
                            <field name="parent_id" 
                                   widget="res_partner_many2one" 
                                   placeholder="Société parente"
                                   domain="[('is_company', '=', True)]"
                                   context="{'default_is_company': True}"
                                   invisible="is_company"/>
                            <field name="function" placeholder="Fonction" invisible="is_company"/>
                            <field name="category_id" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="Tags"/>
                            <field name="email" widget="email"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                            <field name="website" widget="url" placeholder="Site web"/>
                        </group>
                        <group name="group_right">
                            <label for="street" string="Adresse"/>
                            <div class="o_address_format">
                                <field name="street" placeholder="Rue..." class="o_address_street"/>
                                <field name="street2" placeholder="Complément..." class="o_address_street"/>
                                <field name="city" placeholder="Ville" class="o_address_city"/>
                                <field name="state_id" class="o_address_state" placeholder="État" options="{'no_open': True, 'no_create': True}"/>
                                <field name="zip" placeholder="Code postal" class="o_address_zip"/>
                                <field name="country_id" placeholder="Pays" class="o_address_country" options="{'no_open': True, 'no_create': True}"/>
                            </div>
                        </group>
                    </group>
                    <notebook>
                        <page string="Sites" name="sites">
                            <field name="it_site_ids" context="{'default_parent_id': id, 'default_type': 'delivery', 'default_is_it_site': True}">
                                <list>
                                    <field name="name"/>
                                    <field name="street"/>
                                    <field name="city"/>
                                    <field name="phone"/>
                                    <field name="equipment_count"/>
                                </list>
                            </field>
                        </page>
                        <page string="Contacts" name="contacts" invisible="not is_company">
                            <field name="child_ids" mode="kanban" context="{'default_parent_id': id}">
                                <kanban>
                                    <field name="id"/>
                                    <field name="name"/>
                                    <field name="function"/>
                                    <field name="phone"/>
                                    <field name="email"/>
                                    <field name="avatar_128"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
                                                <div class="o_kanban_image">
                                                    <field name="avatar_128" widget="image" class="o_kanban_image"/>
                                                </div>
                                                <div class="oe_kanban_details">
                                                    <strong class="o_kanban_record_title"><field name="name"/></strong>
                                                    <div t-if="record.function.value"><field name="function"/></div>
                                                    <div t-if="record.phone.value">
                                                        <i class="fa fa-phone" role="img" aria-label="Téléphone" title="Téléphone"/> <field name="phone"/>
                                                    </div>
                                                    <div t-if="record.email.value">
                                                        <i class="fa fa-envelope" role="img" aria-label="Email" title="Email"/> <field name="email"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>
                        <page string="Notes internes" name="internal_notes">
                            <field name="comment" placeholder="Notes internes..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
    
    <!-- Vue recherche spécifique pour les clients IT -->
    <record id="view_it_client_search" model="ir.ui.view">
        <field name="name">it.client.search</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Recherche de clients IT">
                <field name="name"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="city"/>
                <field name="country_id"/>
                <group expand="0" string="Regrouper par">
                    <filter string="Ville" name="city" context="{'group_by': 'city'}"/>
                    <filter string="Pays" name="country" context="{'group_by': 'country_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Vue liste spécifique pour les fournisseurs IT -->
    <record id="view_it_supplier_tree" model="ir.ui.view">
        <field name="name">it.supplier.tree</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="category_id" widget="many2many_tags"/>
                <field name="phone"/>
                <field name="email"/>
                <field name="city"/>
                <field name="country_id"/>
                <field name="website" widget="url"/>
            </list>
        </field>
    </record>
    
    <!-- Vue formulaire spécifique pour les fournisseurs IT -->
    <record id="view_it_supplier_form" model="ir.ui.view">
        <field name="name">it.supplier.form</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nom du fournisseur" required="1"/>
                        </h1>
                    </div>
                    <group>
                        <group name="contact_info">
                            <field name="is_company" invisible="1"/>
                            <field name="is_it_supplier" invisible="1"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                            <field name="email" widget="email"/>
                            <field name="category_id" widget="many2many_tags" string="Tags" options="{'color_field': 'color_value', 'no_create_edit': True}"/>
                        </group>
                        <group name="address">
                            <label for="street" string="Adresse"/>
                            <div>
                                <field name="street" placeholder="Rue..."/>
                                <field name="city" placeholder="Ville"/>
                                <div class="d-flex">
                                    <field name="zip" placeholder="Code postal" class="me-2"/>
                                    <field name="country_id" placeholder="Pays" options='{"no_open": True}'/>
                                </div>
                            </div>
                        </group>
                    </group>
                    <notebook>
                        <page string="Contacts" name="contacts">
                            <field name="child_ids" mode="kanban" context="{'default_parent_id': id, 'default_is_it_supplier': True}">
                                <kanban>
                                    <field name="id"/>
                                    <field name="name"/>
                                    <field name="function"/>
                                    <field name="phone"/>
                                    <field name="email"/>
                                    <field name="image_128"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
                                                <div class="o_kanban_image">
                                                    <field name="image_128" widget="image" class="o_kanban_image" alt="Contact Image"/>
                                                </div>
                                                <div class="oe_kanban_details">
                                                    <strong class="o_kanban_record_title"><field name="name"/></strong>
                                                    <div t-if="record.function.value"><field name="function"/></div>
                                                    <div t-if="record.phone.value" class="d-flex align-items-baseline">
                                                        <i class="fa fa-phone me-1" role="img" aria-label="Phone" title="Phone"></i>
                                                        <field name="phone"/>
                                                    </div>
                                                    <div t-if="record.email.value" class="d-flex align-items-baseline">
                                                        <i class="fa fa-envelope-o me-1" role="img" aria-label="Email" title="Email"></i>
                                                        <field name="email"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                <form>
                                    <sheet>
                                        <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                                        <div class="oe_title">
                                            <h1>
                                                <field name="name" placeholder="Nom du contact" required="1"/>
                                            </h1>
                                            <field name="function" placeholder="Fonction"/>
                                        </div>
                                        <group>
                                            <group>
                                                <field name="phone" widget="phone"/>
                                                <field name="mobile" widget="phone"/>
                                                <field name="email" widget="email"/>
                                                <field name="is_it_supplier" invisible="1"/>
                                                <field name="parent_id" invisible="1"/>
                                            </group>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        <page string="Notes" name="notes">
                            <field name="comment" placeholder="Notes sur ce fournisseur..."/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
    
    <!-- Vue recherche spécifique pour les fournisseurs IT -->
    <record id="view_it_supplier_search" model="ir.ui.view">
        <field name="name">it.supplier.search</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Recherche de fournisseurs IT">
                <field name="name"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="city"/>
                <field name="country_id"/>
                <group expand="0" string="Regrouper par">
                    <filter string="Ville" name="city" context="{'group_by': 'city'}"/>
                    <filter string="Pays" name="country" context="{'group_by': 'country_id'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Vue liste pour les sites clients -->
    <record id="view_it_site_tree" model="ir.ui.view">
        <field name="name">res.partner.it.site.tree</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="parent_it_client_id" string="Client"/>
                <field name="ref" string="Code site"/>
                <field name="city"/>
                <field name="phone"/>
                <field name="equipment_count" string="Équipements"/>
                <field name="incident_count" string="Incidents"/>
            </list>
        </field>
    </record>
    
    <!-- Vue formulaire pour les sites clients - version complète sans héritage -->
    <record id="view_it_site_form" model="ir.ui.view">
        <field name="name">res.partner.it.site.form</field>
        <field name="model">res.partner</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button string="Créer un utilisateur portail" 
                            name="action_create_user" 
                            type="object" 
                            class="btn btn-primary"
                            invisible="not email or user_ids"
                            help="Créer un compte utilisateur portail pour ce contact"/>
                    <button string="Ajouter un équipement" type="object" name="action_add_equipment" class="btn btn-primary"/>
                </header>
                <sheet>
                    <div class="alert alert-info d-flex align-items-center mb-3" role="alert">
                        <i class="fa fa-building-o me-2" role="img" aria-label="Client" title="Client parent"></i>
                        <div>
                            Client parent : <field name="parent_it_client_id" required="1" options="{'no_create': True}" class="oe_inline"/>
                        </div>
                    </div>
                    
                    <div name="button_box" class="oe_button_box">
                        <button name="action_view_equipment" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-laptop">
                            <field string="Équipements" name="equipment_count" widget="statinfo"/>
                        </button>
                        <button name="action_view_incidents" 
                                type="object" 
                                class="oe_stat_button" 
                                icon="fa-exclamation-triangle">
                            <field string="Incidents" name="incident_count" widget="statinfo"/>
                        </button>
                    </div>
                    
                    <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nom du site" required="1"/>
                        </h1>
                        <field name="ref" placeholder="Code site"/>
                    </div>
                    
                    <group>
                        <group string="Contact">
                            <field name="is_company" invisible="1"/>
                            <field name="is_it_site" invisible="1"/>
                            <field name="phone" widget="phone"/>
                            <field name="mobile" widget="phone"/>
                            <field name="email" widget="email"/>
                        </group>
                        <group string="Adresse">
                                <field name="street" placeholder="Rue..."/>
                            <field name="street2" placeholder="Complément..."/>
                            <field name="zip" placeholder="Code postal"/>
                                <field name="city" placeholder="Ville"/>
                            <field name="state_id" placeholder="Département"/>
                                    <field name="country_id" placeholder="Pays"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Équipements IT" name="equipment">
                            <div class="alert alert-light mb-3" role="status">
                                <p>Les équipements associés à ce site apparaîtront dans le bouton statistique "Équipements" en haut du formulaire.</p>
                                <p>Utilisez le bouton "Ajouter un équipement" pour ajouter un nouvel équipement sur ce site.</p>
                                                </div>
                        </page>
                        <page string="Accès réseau" name="network">
                            <group>
                                <group string="Accès distant">
                                    <field name="website" string="URL d'accès VPN" placeholder="ex: vpn://site-client.com"/>
                                    <field name="comment" placeholder="Identifiants, procédures..." nolabel="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Notes" name="notes">
                            <field name="comment" placeholder="Notes sur ce site..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Vue recherche pour les sites clients -->
    <record id="view_it_site_search" model="ir.ui.view">
        <field name="name">res.partner.it.site.search</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Rechercher des sites clients">
                <field name="name" string="Nom du site"/>
                <field name="parent_it_client_id"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="city"/>
                <field name="country_id"/>
                <separator/>
                <filter string="Sites clients" name="it_sites" domain="[('is_it_site', '=', True)]"/>
                <group expand="0" string="Regrouper par">
                    <filter string="Client parent" name="parent_client" domain="[]" context="{'group_by': 'parent_it_client_id'}"/>
                    <filter string="Ville" name="city" domain="[]" context="{'group_by': 'city'}"/>
                    <filter string="Pays" name="country" domain="[]" context="{'group_by': 'country_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Vue Kanban pour les sites clients -->
    <record id="view_it_site_kanban" model="ir.ui.view">
        <field name="name">it.client.sites.kanban</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <kanban quick_create="false">
                <field name="id"/>
                <field name="name"/>
                <field name="image_128"/>
                <field name="street"/>
                <field name="city"/>
                <field name="zip"/>
                <field name="state_id"/>
                <field name="country_id"/>
                <field name="phone"/>
                <field name="mobile"/>
                <field name="email"/>
                <field name="parent_id"/>
                <field name="website"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click oe_kanban_card">
                            <div class="o_kanban_image">
                                <field name="image_128" widget="image" class="o_kanban_image" alt="Site Image"/>
                            </div>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <div>
                                            <field name="street"/>
                                        </div>
                                        <div>
                                            <field name="city"/>
                                            <field name="zip"/>
                                        </div>
                                        <div>
                                            <field name="state_id"/>
                                            <field name="country_id"/>
                                        </div>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <div t-if="record.phone.raw_value">
                                            <field name="phone" widget="phone"/>
                                        </div>
                                        <div t-if="record.email.raw_value">
                                            <field name="email" widget="email"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Spécifier les vues à utiliser pour l'action -->
    <record id="action_it_clients_kanban" model="ir.actions.act_window.view">
        <field name="sequence" eval="1"/>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="view_it_clients_kanban"/>
        <field name="act_window_id" ref="it__park.action_it_clients"/>
    </record>

    <record id="action_it_clients_list" model="ir.actions.act_window.view">
        <field name="sequence" eval="2"/>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_it_client_tree"/>
        <field name="act_window_id" ref="it__park.action_it_clients"/>
    </record>

    <record id="action_it_clients_form" model="ir.actions.act_window.view">
        <field name="sequence" eval="3"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_it_client_form"/>
        <field name="act_window_id" ref="it__park.action_it_clients"/>
    </record>

    <!-- Modifions les actions pour utiliser nos vues -->
    <record id="action_it_clients" model="ir.actions.act_window">
        <field name="name">Clients IT</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('display_as_it_client', '=', True), ('is_company', '=', True), ('is_it_site', '=', False)]</field>
        <field name="context">{
            'default_is_it_client': True,
            'default_is_company': True,
            'default_type': 'contact'
        }</field>
        <field name="views">[(5, 0, 0),
                           (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_it_clients_kanban')}),
                           (0, 0, {'view_mode': 'list', 'view_id': ref('view_it_client_tree')}),
                           (0, 0, {'view_mode': 'form', 'view_id': ref('view_it_client_form')})]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouveau client IT
            </p>
            <p>
                Les clients IT sont les entreprises pour lesquelles vous gérez le parc informatique.
            </p>
        </field>
    </record>

    <!-- Vue pour les clients IT en attente -->
    <record id="action_it_clients_pending" model="ir.actions.act_window">
        <field name="name">Clients IT en attente</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_it_client_pending', '=', True)]</field>
        <field name="context">{
            'default_is_it_client_pending': True,
            'default_is_company': True
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Aucun client IT en attente
            </p>
            <p>
                Les clients en attente de validation du contrat apparaîtront ici.
            </p>
        </field>
    </record>

    <!-- Bouton pour valider le contrat -->
    <record id="view_partner_form_it_park_contract" model="ir.ui.view">
        <field name="name">res.partner.form.it.contract</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_validate_it_contract" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-check"
                        string="Valider contrat IT"
                        invisible="not is_it_client_pending or is_it_contract_paid"/>
                        
                <button name="action_force_activate_it_access" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-unlock"
                        string="Forcer accès IT"
                        groups="base.group_system"
                        invisible="is_it_client and is_it_client_approved and is_it_contract_paid"/>
            </xpath>
            <xpath expr="//field[@name='is_it_client']" position="after">
                <field name="is_it_contract_paid" readonly="1"/>
                <field name="is_it_client_pending" readonly="1"/>
                <field name="display_as_it_client" invisible="1"/>
            </xpath>
        </field>
    </record>

    <!-- Action pour les fournisseurs IT -->
    <record id="action_it_suppliers" model="ir.actions.act_window">
        <field name="name">Fournisseurs IT</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_it_supplier', '=', True)]</field>
        <field name="context">{'default_is_it_supplier': True, 'default_is_company': True}</field>
        <field name="views">[(False, 'kanban'), (False, 'list'), (ref('view_it_supplier_form'), 'form')]</field>
        <field name="search_view_id" ref="view_it_supplier_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouveau fournisseur IT
            </p>
        </field>
    </record>

    <!-- Action pour les sites clients -->
    <record id="action_it_sites" model="ir.actions.act_window">
        <field name="name">Sites clients</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_it_site', '=', True)]</field>
        <field name="context">{
            'default_is_it_site': True, 
            'default_is_company': True,
            'default_type': 'contact'
        }</field>
        <field name="views">[(ref('view_it_site_kanban'), 'kanban'), (ref('view_it_site_tree'), 'list'), (ref('view_it_site_form'), 'form')]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouveau site client
            </p>
        </field>
    </record>
    
    <!-- Action pour les sites d'un client spécifique -->
    <record id="action_it_sites_per_client" model="ir.actions.act_window">
        <field name="name">Sites du client</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_it_site', '=', True), ('parent_it_client_id', '=', active_id)]</field>
        <field name="context">{
            'default_is_it_site': True, 
            'default_is_company': True,
            'default_parent_it_client_id': active_id,
            'default_type': 'contact'
        }</field>
        <field name="view_ids" eval="[(5, 0, 0), 
                                      (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_it_site_kanban')}),
                                      (0, 0, {'view_mode': 'list', 'view_id': ref('view_it_site_tree')}),
                                      (0, 0, {'view_mode': 'form', 'view_id': ref('view_it_site_form')})]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouveau site pour ce client
            </p>
        </field>
    </record>

    <!-- Action pour les éditeurs de logiciels -->
    <record id="action_it_editors" model="ir.actions.act_window">
        <field name="name">Éditeurs de logiciels</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">[('is_it_editor', '=', True)]</field>
        <field name="context">{'default_is_it_editor': True, 'default_is_company': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouvel éditeur de logiciels
            </p>
            <p>
                Gérez la liste des éditeurs de logiciels pour faciliter la gestion des licences.
            </p>
        </field>
    </record>
    
    <!-- Action pour les contacts IT -->
    <record id="action_contacts_it_park" model="ir.actions.act_window">
        <field name="name">Contacts IT</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="domain">['|', '|', '|', 
            ('is_it_client', '=', True), 
            ('is_it_supplier', '=', True), 
            ('is_it_site', '=', True),
            ('&amp;', ('parent_id.is_it_client', '=', True), ('is_company', '=', False))]</field>
        <field name="context">{
            'search_default_filter_it': 1,
            'res_partner_search_mode': 'customer',
        }</field>
        <field name="search_view_id" ref="view_it_partner_filter"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créer un nouveau contact IT
            </p>
            <p>
                Gérez vos contacts IT (clients, fournisseurs, sites et contacts individuels).
            </p>
        </field>
    </record>
    
    <!-- Menu principal pour les contacts IT -->
    <menuitem id="contacts_it_park_menu" 
              name="Contacts" 
              action="action_contacts_it_park" 
              web_icon="contacts,static/description/icon.png" 
              sequence="3"/>
</odoo> 